{% extends "base.html" %}
{% block content %}

<div class="container my-5">
  <h4 class="text-center text-primary mb-4">ğŸ“š Courses by {{ teacher.name }}</h4>

  <!-- ğŸ”¹ Add Course Form -->
  <form action="{{ url_for('api.course_add', teacher_id=teacher.id) }}" method="POST" class="row g-3 needs-validation mb-4" novalidate>
    <div class="col-md-6">
      <label class="form-label">Course Title</label>
      <input type="text" name="title" class="form-control" placeholder="e.g. Statistics II" required>
    </div>
    <div class="col-md-6">
      <label class="form-label">Course Code</label>
      <input type="text" name="code" class="form-control" placeholder="e.g. STAT202" required>
    </div>
    <div class="col-md-12 text-end">
      <button type="submit" class="btn btn-success">â• Add Course</button>
    </div>
  </form>

  <!-- ğŸ”¹ Course List -->
  {% if courses %}
  <ul class="list-group">
    {% for c in courses %}
    <li class="list-group-item course-item d-flex justify-content-between align-items-center">
      <span class="course-hover">{{ c.title }} <small class="text-muted">({{ c.code }})</small></span>
      <div class="course-actions d-flex align-items-center gap-2">
        <!-- ğŸ”¹ Session-selectable Attendance Form -->
        <form method="GET" action="{{ url_for('api.course_attendance', course_id=c.id) }}" class="d-flex gap-2 align-items-center">
          <select name="session" class="form-select form-select-sm" required>
            <option value="" disabled selected>Session</option>
            {% for s in session_list %}
            <option value="{{ s }}">{{ s }}</option>
            {% endfor %}
          </select>
          <button type="submit" class="btn btn-sm btn-outline-success">ğŸ“Š</button>
        </form>

        <!-- ğŸ”¹ Materials -->
        <a href="{{ url_for('api.view_materials', course_id=c.id) }}" class="btn btn-sm btn-outline-secondary">ğŸ“¥</a>

        <!-- ğŸ”¹ Delete -->
        <form action="{{ url_for('api.course_delete_by_id', course_id=c.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('Delete this course?')">
          <button type="submit" class="btn btn-sm btn-outline-danger">âŒ</button>
        </form>
      </div>
    </li>
    {% endfor %}
  </ul>
  {% else %}
  <p class="text-muted text-center">No courses assigned yet.</p>
  {% endif %}
</div>

<style>
.course-item {
  position: relative;
}
.course-actions {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  display: none;
}
.course-hover:hover + .course-actions,
.course-item:hover .course-actions {
  display: inline-flex;
}
</style>

<script>
(() => {
  'use strict';
  const forms = document.querySelectorAll('.needs-validation');
  Array.from(forms).forEach(form => {
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  });
})();
</script>

{% endblock %}